language: php
dist: bionic
sudo: required

addons:
  apt:
    update: true
    packages:
      - python3-pip
      - python3-dev
      - python3-setuptools

branches:
  except:
    - master

php:
  - "7.3"

stages:
  - setup
  - integration

before_install:
  - wget https://getcomposer.org/download/1.9.0/composer.phar
  - sudo mv ${PWD}/composer.phar /usr/local/bin/composer
  - sudo chmod +x /usr/local/bin/composer
  - wget https://phar.phpunit.de/phpunit-8.phar
  - sudo mv ${PWD}/phpunit-8.phar /usr/local/bin/phpunit
  - sudo chmod +x /usr/local/bin/phpunit
  - pip3 install wheel

install:
  - pip3 install -r requirements.txt
  - git clone https://salesforce-marketingcloud:${GITHUB_TOKEN}@github.com/salesforce-marketingcloud/MCSDK-Automation-Framework-Core.git ${PWD}/../MCSDK-Automation-Framework-Core
  - cd ${PWD}/../MCSDK-Automation-Framework-Core
  - git checkout -f ${HEAD_BRANCH}
  - cd ${TRAVIS_BUILD_DIR}
  - pip3 install ${PWD}/../MCSDK-Automation-Framework-Core/dist/mcsdk-automation-framework-core-1.0.0.tar.gz

jobs:
  include:
    - stage: integration
      name: "Integration"
      script: python3 ${TRAVIS_BUILD_DIR}/src/integrator/main.py
